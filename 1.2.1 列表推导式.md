# 列表推导式

**列表推导式**是 Python 中一种简洁、优雅的创建列表的方法。它可以用一行代码代替多行的 `for` 循环，让代码更加简洁易读。

## 基本语法

```python
[expression for item in iterable if condition]
```

- `expression`: 对每个元素进行的操作或表达式
- `for item in iterable`: 循环遍历可迭代对象
- `if condition`: 可选的过滤条件

## 简单示例

### 1. 基本列表推导式

**传统写法：**

```python
squares = []
for x in range(5):
    squares.append(x ** 2)
print(squares)  # 输出: [0, 1, 4, 9, 16]
```

**列表推导式写法：**

```python
squares = [x ** 2 for x in range(5)]
print(squares)  # 输出: [0, 1, 4, 9, 16]
```

### 2. 带条件的列表推导式

**传统写法：**

```python
even_squares = []
for x in range(10):
    if x % 2 == 0:
        even_squares.append(x ** 2)
print(even_squares)  # 输出: [0, 4, 16, 36, 64]
```

**列表推导式写法：**

```python
even_squares = [x ** 2 for x in range(10) if x % 2 == 0]
print(even_squares)  # 输出: [0, 4, 16, 36, 64]
```

## 更多实用示例

### 3. 处理字符串

```python
# 将字符串中的字符转换为大写
text = "hello"
upper_chars = [char.upper() for char in text]
print(upper_chars)  # 输出: ['H', 'E', 'L', 'L', 'O']

# 提取字符串中的数字
mixed = "a1b2c3d4"
numbers = [char for char in mixed if char.isdigit()]
print(numbers)  # 输出: ['1', '2', '3', '4']
```

### 4. 嵌套循环

```python
# 创建乘法表
multiplication = [f"{i}x{j}={i*j}" for i in range(1, 4) for j in range(1, 4)]
print(multiplication)
# 输出: ['1x1=1', '1x2=2', '1x3=3', '2x1=2', '2x2=4', '2x3=6', '3x1=3', '3x2=6', '3x3=9']
```

### 5. 处理嵌套列表

```python
# 展平二维列表
matrix = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
flattened = [num for row in matrix for num in row]
print(flattened)  # 输出: [1, 2, 3, 4, 5, 6, 7, 8, 9]

# 提取特定列
matrix = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
first_column = [row[0] for row in matrix]
print(first_column)  # 输出: [1, 4, 7]
```

### 6. 复杂条件过滤

```python
numbers = range(20)
# 找出既能被2整除又能被3整除的数
result = [x for x in numbers if x % 2 == 0 and x % 3 == 0]
print(result)  # 输出: [0, 6, 12, 18]

# 找出长度大于3的单词
words = ["apple", "cat", "dog", "elephant", "hi"]
long_words = [word for word in words if len(word) > 3]
print(long_words)  # 输出: ['apple', 'elephant']
```

### 7. 使用函数

```python
# 使用函数处理元素
def process_number(x):
    return x * 2 + 1

processed = [process_number(x) for x in range(5)]
print(processed)  # 输出: [1, 3, 5, 7, 9]

# 使用内置函数
lengths = [len(word) for word in ["apple", "banana", "cherry"]]
print(lengths)  # 输出: [5, 6, 6]
```

## 条件表达式（三元表达式）

可以在表达式中使用条件判断：

```python
numbers = [1, 2, 3, 4, 5, 6]
# 如果是偶数就平方，如果是奇数就加10
result = [x ** 2 if x % 2 == 0 else x + 10 for x in numbers]
print(result)  # 输出: [11, 4, 13, 16, 15, 36]
```

## 与其他推导式的对比

Python 还有其他的推导式：

**字典推导式：**

```python
squares_dict = {x: x**2 for x in range(5)}
print(squares_dict)  # 输出: {0: 0, 1: 1, 2: 4, 3: 9, 4: 16}
```

**集合推导式：**

```python
unique_squares = {x**2 for x in range(-3, 4)}
print(unique_squares)  # 输出: {0, 1, 4, 9}
```

## 性能优势

列表推导式通常比等效的 `for` 循环更快，因为它们在底层进行了优化：

```python
import timeit

# 测试性能
def test_for_loop():
    result = []
    for i in range(1000):
        result.append(i * 2)

def test_list_comprehension():
    result = [i * 2 for i in range(1000)]

print("For循环:", timeit.timeit(test_for_loop, number=10000))
print("列表推导式:", timeit.timeit(test_list_comprehension, number=10000))
```

## 注意事项

1. **可读性**：虽然简洁，但过于复杂的列表推导式可能难以阅读
2. **调试困难**：由于是一行代码，调试可能不如传统循环方便
3. **内存使用**：会立即创建整个列表，对于大数据集可能消耗较多内存

## 何时使用

**适合使用列表推导式：**

- 简单的数据转换和过滤
- 代码需要简洁明了
- 处理的数据量不大

**不适合使用列表推导式：**

- 逻辑非常复杂，需要多步处理
- 需要处理异常的情况
- 数据量非常大（考虑使用生成器表达式）
