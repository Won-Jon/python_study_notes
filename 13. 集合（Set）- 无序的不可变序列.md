# 集合

## 什么是集合？

集合是 Python 中的一种**无序、可变、不重复元素**的数据结构。它基于数学中的集合概念，主要用于成员测试、去除重复元素和数学集合运算。

## 基本特性

1. **无序性**: 元素没有固定的顺序
2. **唯一性**: 不允许重复元素
3. **可变性**: 可以添加、删除元素
4. **可哈希元素**: 集合元素必须是不可变类型

## 创建集合

### 1. 使用花括号 `{}`

```python
# 创建集合
fruits = {"apple", "banana", "orange", "apple"}  # 重复元素会自动去重
print(fruits)  # 输出: {'banana', 'orange', 'apple'} (顺序可能不同)
print(type(fruits))  # 输出: <class 'set'>
```

### 2. 使用 `set()` 构造函数

```python
# 从列表创建
numbers = set([1, 2, 3, 2, 1])
print(numbers)  # 输出: {1, 2, 3}

# 从元组创建
colors = set(("red", "green", "blue"))
print(colors)  # 输出: {'green', 'blue', 'red'}

# 从字符串创建（每个字符成为元素）
chars = set("hello")
print(chars)  # 输出: {'h', 'e', 'l', 'o'} (去重后)
```

### 3. 空集合的创建

```python
# 错误方式：{} 创建的是空字典
empty_dict = {}
print(type(empty_dict))  # 输出: <class 'dict'>

# 正确方式：使用 set()
empty_set = set()
print(type(empty_set))   # 输出: <class 'set'>
```

## 集合的基本操作

### 添加元素

```python
fruits = {"apple", "banana"}
fruits.add("orange")
print(fruits)  # 输出: {'banana', 'orange', 'apple'}

fruits.add("apple")  # 添加已存在的元素，无变化
print(fruits)  # 输出: {'banana', 'orange', 'apple'}
```

### 更新集合（添加多个元素）

```python
fruits = {"apple", "banana"}
fruits.update(["orange", "grape", "apple"])
print(fruits)  # 输出: {'grape', 'banana', 'orange', 'apple'}

# update() 可以接受任何可迭代对象
fruits.update(("mango", "pineapple"))
print(fruits)  # 输出: 包含所有水果的集合
```

### `add()` 和 `update()` 的区别

| 特性 | `add()` | `update()` |
|------|---------|------------|
| **参数类型** | 单个元素 | 可迭代对象（列表、元组、集合、字符串等） |
| **添加数量** | 一次只能添加一个元素 | 一次可以添加多个元素 |
| **参数要求** | 必须是可哈希的元素 | 必须是可迭代对象，其中的元素必须可哈希 |
| **返回值** | `None`（原地修改） | `None`（原地修改） |

### 删除元素

```python
fruits = {"apple", "banana", "orange"}

# remove() - 删除指定元素，不存在则报错
fruits.remove("banana")
print(fruits)  # 输出: {'orange', 'apple'}

# discard() - 删除指定元素，不存在也不报错
fruits.discard("grape")  # 不会报错
fruits.discard("apple")
print(fruits)  # 输出: {'orange'}

# pop() - 随机删除并返回一个元素
random_fruit = fruits.pop()
print(f"删除了: {random_fruit}")  # 输出: 删除了: orange

# clear() - 清空集合
fruits.clear()
print(fruits)  # 输出: set()
```

## 集合运算

### 1. 并集（Union）

```python
set_a = {1, 2, 3}
set_b = {3, 4, 5}

# 方法1: union() 方法
union_set = set_a.union(set_b)
print(union_set)  # 输出: {1, 2, 3, 4, 5}

# 方法2: | 运算符
union_set = set_a | set_b
print(union_set)  # 输出: {1, 2, 3, 4, 5}
```

### 2. 交集（Intersection）

```python
set_a = {1, 2, 3, 4}
set_b = {3, 4, 5, 6}

# 方法1: intersection() 方法
intersection_set = set_a.intersection(set_b)
print(intersection_set)  # 输出: {3, 4}

# 方法2: & 运算符
intersection_set = set_a & set_b
print(intersection_set)  # 输出: {3, 4}
```

### 3. 差集（Difference）

```python
set_a = {1, 2, 3, 4}
set_b = {3, 4, 5, 6}

# A - B: 在A中但不在B中的元素
diff_set = set_a.difference(set_b)
print(diff_set)  # 输出: {1, 2}

# 使用 - 运算符
diff_set = set_a - set_b
print(diff_set)  # 输出: {1, 2}

# B - A: 在B中但不在A中的元素
diff_set = set_b - set_a
print(diff_set)  # 输出: {5, 6}
```

### 4. 对称差集（Symmetric Difference）

对称差集，也叫异或集，只属于其中一个集合，但不属于两个集合的元素

```python
set_a = {1, 2, 3, 4}
set_b = {3, 4, 5, 6}

# 方法1: symmetric_difference() 方法
sym_diff = set_a.symmetric_difference(set_b)
print(sym_diff)  # 输出: {1, 2, 5, 6}

# 方法2: ^ 运算符
sym_diff = set_a ^ set_b
print(sym_diff)  # 输出: {1, 2, 5, 6}
```

## 集合关系测试

### 子集和超集

```python
set_a = {1, 2, 3}
set_b = {1, 2, 3, 4, 5}
set_c = {1, 2}

# 子集检查
print(set_a.issubset(set_b))  # 输出: True
print(set_c.issubset(set_a))  # 输出: True
print(set_a <= set_b)         # 输出: True

# 真子集检查
print(set_a < set_b)          # 输出: True (A是B的真子集)
print(set_a < set_a)          # 输出: False (不是真子集)

# 超集检查
print(set_b.issuperset(set_a))  # 输出: True
print(set_b >= set_a)           # 输出: True
```

### 不相交检查

检查是否有共同元素

```python
set_a = {1, 2, 3}
set_b = {4, 5, 6}
set_c = {3, 4}

print(set_a.isdisjoint(set_b))  # 输出: True (没有共同元素)
print(set_a.isdisjoint(set_c))  # 输出: False (有共同元素3)
```

## 集合推导式

```python
# 创建1-10的平方的集合
squares = {x**2 for x in range(1, 11)}
print(squares)  # 输出: {64, 1, 4, 36, 100, 9, 16, 49, 81, 25}

# 只保留偶数的平方
even_squares = {x**2 for x in range(1, 11) if x % 2 == 0}
print(even_squares)  # 输出: {64, 4, 36, 100, 16}
```

## 不可变集合：frozenset

```python
# 创建不可变集合
frozen = frozenset([1, 2, 3, 2, 1])
print(frozen)  # 输出: frozenset({1, 2, 3})

# frozenset 是不可变的
try:
    frozen.add(4)  # 会报错
except AttributeError as e:
    print(f"错误: {e}")

# 但可以进行集合运算
frozen2 = frozenset([3, 4, 5])
result = frozen | frozen2  # 并集运算
print(result)  # 输出: frozenset({1, 2, 3, 4, 5})
```

## 常用方法总结

| 方法 | 描述 | 示例 |
|------|------|------|
| `add(x)` | 添加元素 | `s.add(1)` |
| `update(iterable)` | 添加多个元素 | `s.update([1,2,3])` |
| `remove(x)` | 删除元素，不存在则报错 | `s.remove(1)` |
| `discard(x)` | 删除元素，不存在不报错 | `s.discard(1)` |
| `pop()` | 随机删除并返回一个元素 | `s.pop()` |
| `clear()` | 清空集合 | `s.clear()` |
| `copy()` | 返回集合的浅拷贝 | `s2 = s.copy()` |
| `union()` / `\|` | 并集 | `s1.union(s2)` |
| `intersection()` / `&` | 交集 | `s1 & s2` |
| `difference()` / `-` | 差集 | `s1 - s2` |
| `symmetric_difference()` / `^` | 对称差集 | `s1 ^ s2` |
| `issubset()` / `<=` | 子集检查 | `s1 <= s2` |
| `issuperset()` / `>=` | 超集检查 | `s1 >= s2` |
| `isdisjoint()` | 不相交检查 | `s1.isdisjoint(s2)` |

## 实际应用场景

### 1. 去除重复元素

```python
# 从列表中去除重复元素
numbers = [1, 2, 2, 3, 4, 4, 5]
unique_numbers = list(set(numbers))
print(unique_numbers)  # 输出: [1, 2, 3, 4, 5] (顺序可能不同)
```

### 2. 成员测试（比列表快）

```python
# 集合的成员测试是 O(1) 时间复杂度
large_set = set(range(1000000))
print(999999 in large_set)  # 输出: True (非常快)

# 列表的成员测试是 O(n) 时间复杂度
large_list = list(range(1000000))
print(999999 in large_list)  # 输出: True (比较慢)
```

### 3. 找出两个列表的共同元素

```python
list1 = [1, 2, 3, 4, 5]
list2 = [4, 5, 6, 7, 8]

common = set(list1) & set(list2)
print(common)  # 输出: {4, 5}
```

### 4. 找出只在一个列表中出现的元素

```python
list1 = [1, 2, 3, 4, 5]
list2 = [4, 5, 6, 7, 8]

only_in_list1 = set(list1) - set(list2)
only_in_list2 = set(list2) - set(list1)
print(only_in_list1)  # 输出: {1, 2, 3}
print(only_in_list2)  # 输出: {6, 7, 8}
```

## 注意事项

1. **无序性**: 不要依赖元素的顺序
2. **不可哈希元素**: 集合不能包含列表、字典等可变对象

   ```python
   # 错误示例
   invalid_set = {[1, 2], [3, 4]}  # 会报错: TypeError
   ```

3. **性能**: 集合的查找操作比列表快很多
4. **内存使用**: 集合通常比列表占用更多内存
