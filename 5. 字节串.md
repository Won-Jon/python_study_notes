
# 1. 字节串（bytes）详解

## 字节串（bytes）详解

字节串（`bytes`）是 Python 中用于表示**不可变字节序列**的数据类型。它与字符串（`str`）非常相似，但字符串处理的是 Unicode 字符，而字节串处理的是原始字节数据。

### 1. 字节串的本质

* **序列：** 字节串是字节的有序集合，可以像列表或元组一样进行索引和切片操作。
* **不可变性：** 字节串一旦创建，就不能修改其内容。如果要修改，需要创建新的字节串。
* **字节：** 字节串中的每个元素都是一个字节，即一个介于 0 到 255 之间的整数。

### 2. 字节串与字符串的区别

| 特性        | 字符串（str）                                  | 字节串（bytes）                                  |
| ----------- | -------------------------------------------- | -------------------------------------------- |
| 内容        | Unicode 字符序列                             | 字节序列                                         |
| 编码        | 隐式 Unicode 编码                             | 无编码，直接表示原始字节                               |
| 不可变性     | 不可变                                        | 不可变                                        |
| 字面量表示    | `'Hello'` 或 `"Hello"`                       | `b'Hello'`                                    |
| 应用场景     | 文本处理、国际化                                | 网络传输、文件读写（二进制模式）、图像处理、加密解密 |

### 3. 创建字节串

* **字面量：** 在字符串前加上 `b` 前缀：

    ```python
    b = b'hello'

    # 只能包含 ASCII 字符，超出范围的字符需要转义

    # b = b'你好'  # SyntaxError: invalid syntax

    b = b'\xe4\xbd\xa0\xe5\xa5\xbd'  # '你好' 的 UTF-8 编码
    ```

* **`bytes()` 构造函数：**

  * 从字符串创建：

    ```python
    s = "hello"
    b = bytes(s, encoding='utf-8')  # 指定编码
    ```

  * 从可迭代对象创建：

    ```python
    l = [72, 101, 108, 108, 111]
    b = bytes(l)

    # range() 生成也可以
    b = bytes(range(65, 70)) # bytes 类型  b'ABCDE'
    ```

* **`.encode()` 方法：**  字符串对象的方法，将字符串编码成字节串。

    ```python
    s = "你好"
    b = s.encode('utf-8')  # 编码成 UTF-8 字节串
    ```

### 4. 字节串的操作

由于字节串是不可变的，所以很多操作都会返回新的字节串。

* **索引和切片：**  与字符串类似，索引访问单个字节（返回整数），切片返回新的字节串。

    ```python
    b = b'hello'
    print(b[0])    # 104 (h 的 ASCII 码)
    print(b[1:3])  # b'el'
    ```

* **拼接：** 使用 `+` 运算符进行拼接。

    ```python
    b1 = b'hello'
    b2 = b' world'
    b3 = b1 + b2  # b'hello world'
    ```

* **格式化：**  可以使用 `%` 运算符或 `.format()` 方法进行格式化。

    ```python
    b = b'name: %s, age: %d' % (b'Alice', 30)
    b = b'name: {name}, age: {age}'.format(name=b'Bob', age=25)
    ```

* **常用方法：**

    与字符串类似，字节串也有很多方法，但返回的通常是字节串或整数。

  * `find(), replace(), startswith(), endswith(), lower(), upper(), strip()`

### 5. 字节串的编码与解码

* **编码（encode）：**  将字符串转换为字节串。

    ```python
    s = "你好"
    b = s.encode('utf-8')  # 编码成 UTF-8
    ```

* **解码（decode）：**  将字节串转换为字符串。

    ```python
    b = b'\xe4\xbd\xa0\xe5\xa5\xbd'
    s = b.decode('utf-8')  # 解码成 UTF-8 字符串
    ```

    **注意：**  编码和解码必须使用相同的编码方式，否则可能出现乱码。

### 6. 字节数组（bytearray）

`bytearray` 是字节串**可变**的版本。  你可以把它看作是字节组成的列表。

```python

# 创建 bytearray
ba = bytearray(b'hello')
ba = bytearray([72, 101, 108, 108, 111]) #  列表的每个值都应该是 0 - 255

# 修改元素
ba[0] = 74  # 修改第一个字节为 J
print(ba)  # bytearray(b'Jello')

# 添加元素
ba.append(32)
ba.extend(b'world')

# 删除元素
del ba[0]

```

### 7. 使用场景

* **网络编程：**  网络传输的数据通常是字节流。
* **文件操作：**  以二进制模式读写文件时，处理的是字节串。
* **图像处理：**  图像数据通常以字节形式存储。
* **加密解密：**  加密算法处理的是字节数据。
* **底层操作：**  与操作系统或硬件交互时，需要处理字节数据。

### 总结

字节串是 Python 中处理原始字节数据的关键数据类型，理解其特性和操作对于进行网络编程、文件操作、图像处理等任务至关重要。 区分好字符串和字节串有助于避免编码问题。
