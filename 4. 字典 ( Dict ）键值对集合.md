# Python 字典（dict）完全解析

字典（dict）是 Python 最核心和灵活的数据结构之一，提供了高效的键值对存储和查询功能。

## 字典的基本特性

1. **键值对存储**：以 `{key: value}` 的形式存储数据
2. **无序性**（Python 3.7+ 开始有序，但仍不推荐依赖顺序）
3. **可变性**：创建后可修改、添加或删除条目
4. **键必须唯一且不可变**：键只能是可哈希（hashable）类型（如字符串、数字、元组）
5. **高效查找**：基于哈希表实现，查找时间复杂度为 O(1)

## 创建字典

```python
# 1. 使用花括号
d1 = {'name': 'Alice', 'age': 25}

# 2. 使用 dict() 构造函数
d2 = dict(name='Bob', age=30)

# 3. 使用键值对序列
d3 = dict([('name', 'Charlie'), ('age', 35)])

# 4. 字典推导式
d4 = {x: x**2 for x in (2, 4, 6)}  # {2: 4, 4: 16, 6: 36}

# 5. 创建空字典
empty_dict = {}
```

## 字典操作

### 访问元素

```python
person = {'name': 'Alice', 'age': 25}
print(person['name'])  # 输出: Alice

# 安全访问（避免KeyError）
print(person.get('gender', '未知'))  # 输出: 未知
```

### 修改/添加元素

```python
person['age'] = 26  # 修改
person['gender'] = '女'  # 添加
```

### 删除元素

```python
del person['age']  # 删除键值对
val = person.pop('name')  # 删除并返回value
person.clear()  # 清空字典
```

### 检查键存在

```python
if 'name' in person:
    print(person['name'])
```

### 遍历字典

```python
# 遍历键
for key in person:
    print(key)

# 遍历键值对
for key, value in person.items():
    print(f"{key}: {value}")
```

## 字典的常用方法

| 方法 | 描述 |
|------|------|
| `keys()` | 返回所有键的视图 |
| `values()` | 返回所有值的视图 |
| `items()` | 返回所有键值对的视图 |
| `get(key, default)` | 安全获取值，不存在时返回默认值 |
| `update(other_dict)` | 合并另一个字典的内容 |
| `setdefault(key, default)` | 若键不存在则设置默认值 |
| `pop(key, default)` | 删除并返回值 |
| `popitem()` | 删除并返回随机项（LIFO顺序Python 3.7+） |

## 字典的特殊功能

### 1. 默认字典 (defaultdict)

```python
from collections import defaultdict
dd = defaultdict(int)  # 默认值0
dd['count'] += 1  # 自动初始化
```

### 2. 有序字典 (OrderedDict)

```python
from collections import OrderedDict
od = OrderedDict(a=1, b=2)  # 保证插入顺序
```

### 3. 合并字典 (Python 3.9+)

```python
d1 = {'a': 1}
d2 = {'b': 2}
merged = d1 | d2  # {'a': 1, 'b': 2}
```

### 4. 快速创建字典

```python
chars = ['a', 'b', 'c']
dict.fromkeys(chars, 0)  # {'a': 0, 'b': 0, 'c': 0}
```

## 字典与JSON的关系

字典和JSON对象有相似的格式，可以方便转换：

```python
import json
person_dict = {'name': 'Alice', 'age': 25}

# 字典转JSON字符串
json_str = json.dumps(person_dict)  # '{"name": "Alice", "age": 25}'

# JSON字符串转字典
new_dict = json.loads(json_str)
```

## 字典的底层实现

Python 字典使用**哈希表**（hash table）实现，包含：

1. **哈希函数**：计算键的哈希值
2. **数组（哈希桶）**：存储实际数据
3. **开放寻址法**解决哈希冲突

这种实现使得字典的查找、插入和删除操作的平均时间复杂度为O(1)。

## 字典的性能考虑

1. **键的选择**：使用简单、不可变的类型作为键（如字符串、数字）
2. **内存使用**：字典比列表占用更多内存
3. **预分配大小**：创建大字典时可预估大小

   ```python
   large_dict = dict.fromkeys(range(100000))
   ```

## 字典的最佳实践

1. **数据聚合**：统计词频

   ```python
   words = ["a", "b", "a", "c", "b"]
   freq = {}
   for word in words:
       freq[word] = freq.get(word, 0) + 1
   ```

2. **数据分组**：按属性分组对象
3. **配置存储**：存储程序配置参数
4. **替代多分支条件**：映射模式

   ```python
   actions = {'start': start_func, 'stop': stop_func}
   action = actions.get(user_input, default_func)
   ```
