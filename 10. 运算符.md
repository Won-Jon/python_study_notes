# 运算符

## 算术运算符

| 运算符 | 名称 | 示例 |
|:------:|:-----:|:-----:|
| `+` | 加法 | `5 + 3` |
| `-` | 减法 | `5 - 3` |
| `*` | 乘法 | `5 * 3` |
| `/` | 除法 | `5 / 3` |
| `//` | 整数除法 | `5 // 3` |
| `%` | 取模 | `5 % 3` |
| `**` | 幂 | `5 ** 3` |

### 2.1 `+` 加法

执行数字相加操作，也可以拼接字符串

```python
>>> 5 + 3
8
>>> "Python" + "Java"
'PythonJava'
```

### 2.2 `-` 减法

从第一个操作数中减去第二个操作数

```python
>>> 10 - 3
7
```

### 2.3 `*` 乘法

计算两个操作数的乘积

```python
>>> 4 * 5
20
>>> 3 * "Hi"
'HiHiHi'
```

### 2.4 `/` 除法

执行浮点数除法，总是返回浮点数结果

```python
>>> 10 / 3
3.3333333333333335
>>> 5 / 2
2.5
```

### 2.5 `//` 整数除法

执行除法操作，但结果只保留整数部分，不四舍五入

```python
>>> 10 // 3
3
>>> 5 // 2
2
```

### 2.6 `%` 取模运算

返回除法的剩余部分

```python
>>> 10 % 3  # 10 除以 3 是 3×3=9，10-9=1
1
>>> 5 % 2   # 5 除以 2 是 2×2=4，5-4=1
1
```

### 2.7 `**` 幂运算

计算第一个操作数的第二个操作数次方

```python
>>> 2 ** 3  # 2 的 3 次方
8
>>> 3 ** 2
9
```

### 3. 示例代码

```python
# 基本算术运算
a = 10
b = 3

# 加法
print(f"{a} + {b} = {a + b}")  # 输出：10 + 3 = 13

# 减法
print(f"{a} - {b} = {a - b}")  # 输出：10 - 3 = 7

# 乘法
print(f"{a} * {b} = {a * b}")  # 输出：10 * 3 = 30

# 除法
print(f"{a} / {b} = {a / b:.2f}")  # 输出：10 / 3 = 3.33

# 整数除法
print(f"{a} // {b} = {a // b}")  # 输出：10 // 3 = 3

# 取模
print(f"{a} % {b} = {a % b}")  # 输出：10 % 3 = 1

# 幂运算
print(f"{b} ** {a} = {b ** a}")  # 输出：3 ** 10 = 59049
```

### 4. 注意事项

1. 在 Python 3 中，`/` 运算符总是返回浮点数，即使两个操作数都是整数
2. 使用 `//` 运算符获取整数结果，它会进行向下取整
3. 可以使用 `math` 模块执行更高级的数学运算，例如求平方根、绝对值等
4. 注意浮点数精度问题，在需要精确计算时，谨慎使用浮点数运算

## 赋值运算符

| 运算符 | 功能 | 示例 |
|:------:|:-----|:-----:|
| `+=` | 带赋值的加法 | `a += 3` 等同于 `a = a + 3` |
| `-=` | 带赋值的减法 | `a -= 3` 等同于 `a = a - 3` |
| `*=` | 带赋值的乘法 | `a *= 3` 等同于 `a = a * 3` |
| `/=` | 带赋值的除法 | `a /= 3` 等同于 `a = a / 3` |
| `//=` | 带赋值的整数除法 | `a //= 3` 等同于 `a = a // 3` |
| `%=` | 带赋值的取模 | `a %= 3` 等同于 `a = a % 3` |
| `**=` | 带赋值的幂运算 | `a **= 3` 等同于 `a = a ** 3` |

例如：

```python
>>> a = 10
>>> a += 5
>>> a
15
>>> a *= 2
>>> a
30
```

## 比较运算符

比较运算符用于比较两个值之间的关系，并返回布尔值 `True` 或 `False`。这些运算符在各种条件判断、循环控制等场景中非常有用。

| 运算符 | 描述         | 示例           | 结果  |
|--------|--------------|----------------|------|
| `==`   | 等于         | `5 == 3`       | False |
| `!=`   | 不等于       | `5 != 3`       | True  |
| `>`    | 大于         | `5 > 3`        | True  |
| `<`    | 小于         | `5 < 3`        | False |
| `>=`   | 大于或等于   | `5 >= 5`       | True  |
| `<=`   | 小于或等于   | `5 <= 3`       | False |

### 基础示例

```python
a = 5
b = 3

print(a == b)  # False
print(a != b)  # True
print(a > b)   # True
print(a < b)   # False
print(a >= b)  # True
print(a <= b)  # False
```

## 特殊比较行为

Python 的比较运算符具有一些特殊行为需要注意：

### 1. 链式比较

Python 支持链式比较表达式，使代码更简洁：

```python
x = 5
print(1 < x < 10)  # True，等同于 1 < x and x < 10
print(3 <= x <= 7) # True
```

### 2. 字符串比较

字符串按字典序（Unicode 码位）进行比较：

```python
print("apple" < "banana")  # True
print("cat" > "dog")       # False
print("A" < "a")           # True (大写字母的码位小于小写字母)
```

> python中字符串有字符串驻留池，字符串常量被存储在字符串驻留池中，因此字符串常量相同时，它们在内存中的地址相同。通常是短字符串（通常是长度 ≤ 20 的仅包含ASCII字母、数字、下划线的字符串），长字符串和包含特殊字符的字符串不会存储在字符串驻留池中。

### 3. 不同类型比较

不同类型之间比较遵循特定规则：

```python
print(1 == True)   # True (因为 bool 是 int 的子类，True == 1)
print(0 == False)  # True (False == 0)
print(1.0 == 1)    # True (数值相等)

# 不推荐不同基本类型间直接比较
print("123" > 100)  # TypeError 会报错
```

## 对象比较

### 1. `is` 和 `is not` 运算符

比较两个对象是否是同一对象（内存地址相同）：

```python
a = [1, 2]
b = a
c = [1, 2]

print(a is b)     # True
print(a is c)     # False (值相同但不是同一对象)
print(a == c)     # True (值相等)
```

>`==` 和 `is` 最简单直接的区别：
>
> - `is`：比较的是两个对象是否是同一个对象（内存地址是否相同）
> - `==`：比较的是两个对象是否相等（内容是否相同）
>
> Python会对小整数（-5到256）进行缓存，这会影响 `is` 的结果

### 2. `in` 和 `not in` 运算符

检查元素是否存在于容器中：

```python
nums = [1, 2, 3]
print(2 in nums)      # True
print(4 not in nums)  # True

d = {"a": 1, "b": 2}
print("a" in d)       # True (检查键)
print(1 in d)         # False (不检查值)
```

## 自定义比较

类可以通过实现特殊方法自定义比较行为：

```python
class Person:
    def __init__(self, age):
        self.age = age
  
    def __lt__(self, other):
        return self.age < other.age

p1 = Person(20)
p2 = Person(30)
print(p1 < p2)  # True (调用 __lt__ 方法)
```

>Python 使用一种叫做"魔术方法"的机制来实现运算符重载。这些方法有固定的、由 Python 解释器定义的名称
>
> - `==` 运算符对应 `__eq__` 方法（equal）
> - `!=` 运算符对应 `__ne__` 方法（not equal）
> - `<` 运算符对应 `__lt__` 方法（less than）
> - `>` 运算符对应 `__gt__` 方法（greater than）
> - ...

## 运算符优先级

在 Python 中，运算符有不同的优先级。 以下是从高到低的运算符优先级列表：

__从最高到最低优先级排序：__

1. __括号__ `()`：用于分组表达式，强制指定计算顺序。括号内的表达式总是最先计算。
2. __指数运算__ `**`：幂运算，从右向左结合。 例如，`2 ** 3 ** 2` 等同于 `2 ** (3 ** 2)`，结果为 512。
3. __正负号__ `+x`, `-x`：一元加和一元减。
4. __乘除法及其变体__ `*`, `/`, `//`, `%`：乘法、除法、整除和取余。 相同优先级下，从左向右计算。
5. __加减法__ `+`, `-`：加法和减法。 相同优先级下，从左向右计算。
6. __位运算__ `<<`, `>>`, `&`, `^`, `|`：位左移、位右移、位与、位异或、位或。
7. __比较运算符__ `in`, `not in`, `is`, `is not`, `<`, `<=`, `>`, `>=`, `!=`, `==`：包括成员关系测试、身份测试和大小比较。 多个比较运算可以链式使用，例如 `1 < x < 5`。
8. __逻辑非__ `not`：对布尔值取反。
9. __逻辑与__ `and`：只有所有操作数都为真时才返回真。
10. __逻辑或__ `or`：只要有任何操作数为真就返回真。
11. __赋值运算符__ `=`, `+=`, `-=`, `*=`, `/=`, `//=`, `%=`, `**=`, `&=`, `|=`, `^=`, `>>=`, `<<=`：赋值和复合赋值。 从右向左结合。

### 详细示例

```python
# 1. 括号
print((2 + 3) * 4)  # 结果: 20，先计算括号内的加法

# 2. 指数运算
print(2 ** 3 ** 2)  # 结果: 512 (2 ** (3 ** 2))
print((2 ** 3) ** 2) # 结果: 64  ((2 ** 3) ** 2)

# 3. 正负号
x = -5
print(-x)         # 结果: 5
print(+x) # 结果:-5

# 4. 乘除法及其变体
print(10 / 2 * 3)  # 结果: 15.0 (从左向右计算)
print(10 // 3)    # 结果: 3 (整除)
print(10 % 3)     # 结果: 1 (取余)

# 5. 加减法
print(5 + 3 - 2)   # 结果: 6 (从左向右计算)

# 6. 位运算
print(5 & 3)       # 结果: 1 (位与)
print(5 | 3)       # 结果: 7 (位或)
print(5 ^ 3)       # 结果: 6 (位异或)

# 7. 比较运算符
x = 5
print(1 < x < 10)  # 结果: True (链式比较)
print(x == 5)      # 结果: True
print(x != 3)      # 结果: True

# 8. 逻辑非
print(not True)    # 结果: False
print(not 5 > 3)   # 结果: False

# 9. 逻辑与
print(True and False)  # 结果: False

# 10. 逻辑或
print(True or False)   # 结果: True

# 11. 赋值运算符
x = 5
x += 3           # x 现在是 8
print(x)

# 组合示例
print(5 + 3 * 2 > 10 or not False)  # 优先级: * > + > > > not > or  结果: True
```

### 重要提示

- 使用括号 `()` 可以清晰地控制和改变计算顺序，建议在复杂的表达式中多使用括号，以提高代码可读性。
- 理解运算符优先级是阅读和编写 Python 代码的基础，避免因优先级错误导致 bug。
- 当不确定优先级时，查阅 Python 官方文档是最好的方法。
- 优先级决定的是表达式的分组，而不是执行顺序，短路评估会覆盖正常的从左到右计算顺序，即使 not 优先级更高，但 and 的短路行为会让计算在左侧就停止

    ```python
    res = 3 > 4 and not 4 > 3 or 1 == 3 and 'x' == 'x' or 3 > 3
    # 实际分组为
    res = (3 > 4 and (not 4 > 3)) or (1 == 3 and 'x' == 'x') or 3 > 3
    # 执行顺序如下
    def test_compare(a, b, op):
    result = eval(f"{a} {op} {b}")
    print(f"执行了: {a} {op} {b} = {result}")
    return result
    # 重写表达式来测试
    res = (test_compare(3, 4, '>')
        and not test_compare(4, 3, '>')
        or test_compare(1, 3, '==')
        and test_compare('x', 'x', '==')
        or test_compare(3, 3, '>'))
    # 输出结果
    # 执行了: 3 > 4 = False
    # 执行了: 1 == 3 = False
    # 执行了: 3 > 3 = False
    # 最终结果: False
    ```

## 实用技巧

### 1. 安全比较

避免 `None` 比较时出错：

```python
x = None
print(x is None)  # True (推荐方式)
print(x == None)  # 也可以，但前者更明确
```

### 2. 浮点数比较

处理浮点数精度问题：

```python
# 不推荐
print(0.1 + 0.2 == 0.3)  # False (浮点精度问题)

# 推荐
import math
print(math.isclose(0.1 + 0.2, 0.3))  # True
```

### 3. 短路评估

比较表达式从左到右评估，一旦可以确定结果就会停止：

```python
def check(x):
    print(f"Checking {x}")
    return x > 0

print(check(1) and check(2))  # 会检查两个
print(check(0) and check(2))  # 只检查第一个
```

## 总结

比较运算符在Python中：

1. 总是返回布尔值 `True` 或 `False`
2. 支持链式比较表达式
3. 不同类型的比较有时会产生意外结果（应尽量避免）
4. `==` 比较值，`is` 比较对象身份
5. 对于自定义类型可以通过实现魔术方法来自定义比较行为
